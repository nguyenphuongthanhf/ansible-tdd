{% set index = 1 %}
{% for group_name, hosts in groups.iteritems() %}
{%- if (group_name !='ungrouped') and (group_name !='all') -%}
[{{group_name}}]
{% for  host_name in hosts %}
{{group_name}}{{index}} ansible_host={{hostvars[host_name]["public_ip"]}} ansible_ssh_user={{hostvars[host_name]["ansible_ssh_user"]}} ansible_port={{hostvars[host_name]["ansible_port"]}} instance_id={{hostvars[host_name]["instances_id"]}} aws_region={{hostvars[host_name]["aws_region"]}} private_ip={{hostvars[host_name]["private_ip"]}} internal_hostname={{group_name}}{{index}}.internal
{% set index = index + 1 %}
{% endfor %}
{%- endif %}
{% endfor %}





